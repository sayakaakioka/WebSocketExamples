# 特定の相手にのみデータを送信するサンプル

[echo](../echo/)では、サーバが受信したデータはすべてのクライアントに送信された。
ここに置いてあるサンプルでは、データを送信する相手を指定する機能を追加する。
データを送信する相手を指定する方法が必要なため、サーバと送受信するデータの形式を以下のように定める。

* クライアントからサーバへ送信するメッセージ:
    `{送りたい相手},{送りたいデータ}`
* サーバからクライアントへ送信するメッセージ:
    `{送信者},{送信されたデータ}`

このとき、送りたいデータに改行が含まれていると、上記形式にマッチしないと見做される。
また余計なスペース等を含んではいけない。

データを送りたい相手の部分は、以下のようにする。

* 全員に送りたい場合: `{}`
* ひとりだけに送りたい場合:`{送りたい相手の名前}`
* 複数のクライアントに送りたい場合: `{送りたい相手1, 送りたい相手2, ...}`

また、各クライアントは最初に自分の名前を登録する必要がある。
クライアントが`{自分の名前},{REGISTER}`というデータを送信すると、
サーバが登録作業を行うというルールにする。

ファイルの構成は以下の通り。

* [server.js](./server.js):
    サーバプログラム。[echo](../echo/)の[server.js](../echo/server.js)にユーザ管理と、
    データの個別送信機能を追加したプログラム。
    複数ユーザへのデータ送信を確認するために、ボタンが少し増えている。
* [client.html](./client.html):
    [echo](../echo/)の[client.html](../echo/client.html)の冒頭にユーザ名を登録する部分を追加し、
    上記で定めたルールに従ってデータを送受信するように変更したもの。
* [client2.html](./client2.html):
    [client.html](./client.html)と名前以外は同じもの。
    本来は[client.html](./client.html)をブラウザで複数開くことでクライアントを複数作成できるが、
    名前を変える作業が面倒なため、動作検証用に用意した。
* [client.pde](./client/client.pde):
    Processing版クライアントプログラム。
    制御プログラムやデータ分析プログラムなどのProcessingで書かれたプログラムでデータを送受信する場合には、
    このプログラムを参考にして書けば良い。
    [echo](../echo/)の[client.pde](../echo/client/client.pde)の冒頭にユーザ名を登録する部分を追加し、
    上記で定めたルールに従ってデータを送受信するように変更したもの。
    クライアント全員に向けたメッセージと、`client.html`のみに向けたメッセージを
    交互に送信する。

なお、今回は[echo](../echo/)をベースにしているので、`送りたいデータ`の部分には
文字列がそのまま入っているが、[binary](../binary/)のように画像データを入れたり、
[multi](../multi/)のように文字列と画像の両方を扱うことができる形式のデータを
入れることもできる。
