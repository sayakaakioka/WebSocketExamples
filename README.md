# WebSocketExamples

WebSocketを用いたサーバプログラムやクライアントプログラムのサンプルいろいろ。

サーバプログラムを動かすパソコンでは、[Node.js](https://nodejs.org/ja/)が動いている必要があり、さらにwsモジュールが必要。

Processingで書かれたクライアントプログラムを動かすには、[Processing](https://processing.org)が動いており、Websocketsライブラリがインストールされている必要がある。

環境構築については、[別文書](setup.md)を参照すること。

## ここに置いてあるソースコードの説明

右上の辺りにある「Code」ボタンを押すと現れる「Download ZIP」を選ぶと、ここにあるファイルを全て
zipファイルに固めたものをダウンロードすることができる。プログラムは以下のように各ディレクトリに
整理されている。

* [echo](./echo/):
    1番シンプルなサンプル。
    クライアントが送信した文字列を全員に送信するサーバプログラムとクライアントプログラム。
* [binary](./binary/):
    [echo](./echo/)を改良して、画像を送受信できるようにしたサンプル。
* [multi](./multi/):
    [echo](./echo/)や[binary](./binary/)を改良して、文字列も画像も送受信できるようにしたサンプル。
* [mention](./mention/):
    [echo](./echo/)を改良して、特定のクライアントのみにメッセージを送信できるようにしたサンプル。

## 動かし方（上記のいずれの場合でも共通）

### サーバプログラム

サーバプログラムは必ず最初に起動する。
まずは、Windowsの場合はコマンドプロンプトで、Macの場合はターミナルで、サーバプログラムがある
ディレクトリに移動する。たとえば、[echo](./echo/)を試したいのであれば、まずは以下のコマンドで移動する。

```sh
% cd echo
```


その後、以下のコマンドでサーバプログラムを実行する。

```sh
% node server.js
```

### クライアントプログラム（HTML版）

クライアントプログラムを起動する前に、サーバプログラムが起動済みであることを確認すること。
また、ソースコードの先頭辺りを見て、サーバの設定が合っているか確認すること。

`client.html`をブラウザで開く。
ブラウザによりファイルの開き方は多少異なるが、多くの場合は、メニューの「ファイル」の中にある「ファイルを開く」で
開くファイルを選ぶことができる。

ブラウザは何を使っても良いが、Google Chromeが無難かも。
右上の設定ボタンから「その他のツール」を選ぶと現れる「デベロッパツール」があるとデバッグが楽になる。

### クライアントプログラム（Processing版）

起動する前に、サーバプログラムが起動済みであることを確認すること。
また、ソースコードの先頭辺りを見て、サーバの設定が合っているか確認すること。
ライブラリがインストールされていることを確認すること。

起動自体は、いつも通り、`client`ディレクトリの中の`client.pde`をクリックすることで起動する。

## 参考文献

実装したい機能と言語をキーワードにググるのが、一番有効。色々なプログラムが引っかかってくる。
より一般的な実装方法ほど、多くの人が実装して公開してくれているので、いくつか見比べながら書くと良い。

[wsの本家](https://github.com/websockets/ws)にある
[APIドキュメント](https://github.com/websockets/ws/blob/master/doc/ws.md)
を見ると、利用可能なイベントや関数などが一覧できる。

Processing用のWebSocketライブラリの[本家](https://github.com/alexandrainst/processing_websockets)も参考になる。
